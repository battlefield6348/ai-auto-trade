# æ¸¬è©¦è¦ç¯„ (Testing Standards)

æœ¬æ–‡ä»¶å®šç¾© AI Auto Trade å°ˆæ¡ˆçš„æ¸¬è©¦è¦æ±‚ã€ç­–ç•¥èˆ‡æœ€ä½³å¯¦è¸ã€‚

---

## 1. æ¸¬è©¦ç›®æ¨™ (Total Coverage > 80%)

ç‚ºäº†ç¢ºä¿æ ¸å¿ƒäº¤æ˜“é‚è¼¯èˆ‡å›æ¸¬ç³»çµ±çš„ç©©å®šæ€§ï¼Œå°ˆæ¡ˆè¦æ±‚ **æ•´é«”ç¨‹å¼ç¢¼æ¸¬è©¦è¦†è“‹ç‡å¿…é ˆå§‹çµ‚ä¿æŒåœ¨ 80% ä»¥ä¸Š**ã€‚

### 1.1 åˆ†å±¤æ¸¬è©¦é‡é»
*   **Domain å±¤ (100% è¦†è“‹ç›®æ¨™)**: åŒ…å« `evaluator.go`ã€`scoring_model.go` ç­‰æ ¸å¿ƒç­–ç•¥åˆ¤æ–·é‚è¼¯ã€‚ç”±æ–¼é€™æ˜¯ç³»çµ±æœ€é—œéµçš„éƒ¨åˆ†ï¼Œæ‰€æœ‰åˆ†æ”¯ï¼ˆHappy path, Edge cases, Failure pathsï¼‰éƒ½å¿…é ˆè¢«æ¸¬è©¦ã€‚
*   **Application å±¤ (> 8Bit è¦†è“‹ç›®æ¨™)**: æ¸¬è©¦ Use Cases (å¦‚ `backtest_usecase.go`, `save_usecase.go`)ã€‚æ‡‰ä½¿ç”¨ Mocking æŠ€è¡“éš”é›¢è³‡æ–™åº«èˆ‡å¤–éƒ¨ APIã€‚
*   **Infrastructure å±¤ (> 60% è¦†è“‹ç›®æ¨™)**: æ¸¬è©¦ Repository èˆ‡å¤–éƒ¨æ•´åˆã€‚ä½¿ç”¨ `sqlmock` æ¨¡æ“¬è³‡æ–™åº«æ“ä½œï¼Œç¢ºä¿ SQL æŸ¥è©¢èªæ³•æ­£ç¢ºã€‚

---

## 2. æ¸¬è©¦ç­–ç•¥

### 2.1 å–®å…ƒæ¸¬è©¦ (Unit Tests)
*   **å‘½åæ…£ä¾‹**: æª”æ¡ˆå‘½åç‚º `*_test.go`ï¼Œå‡½å¼å‘½åç‚º `TestXxx`ã€‚
*   **æ–·è¨€å·¥å…·**: ä½¿ç”¨ Go æ¨™æº–åº«çš„ `testing` å‡½å¼ã€‚
*   **Mocking**:
    *   è³‡æ–™åº«: ä½¿ç”¨ `github.com/DATA-DOG/go-sqlmock`ã€‚
    *   ä»‹é¢ (Interfaces): å®šç¾© Mock çµæ§‹å¯¦ä½œä»‹é¢ï¼ˆå¦‚ `mockDataProvider`ï¼‰ã€‚

### 2.2 è¦†è“‹ç‡æª¢æŸ¥æŒ‡ä»¤
åœ¨æ ¹ç›®éŒ„åŸ·è¡Œï¼š
```bash
go test -coverprofile=coverage.out ./...
go tool cover -func=coverage.out
```
æŸ¥çœ‹è©³ç´°è¦–è¦ºåŒ–å ±å‘Šï¼š
```bash
go tool cover -html=coverage.out
```

---

## 3. æ¸¬è©¦æ’°å¯«æŒ‡å¼•

1.  **å„ªå…ˆæ¸¬è©¦é—œéµé‚è¼¯**: æ¶‰åŠè³‡é‡‘è¨ˆç®—ã€æ¢ä»¶è§¸ç™¼ã€æ¬Šé‡è¨ˆç®—çš„éƒ¨åˆ†å„ªå…ˆæ’°å¯«ã€‚
2.  **è¦†è“‹éŒ¯èª¤è·¯å¾‘**: ä¸è¦åªæ¸¬è©¦æˆåŠŸçš„æ¡ˆä¾‹ï¼Œå¿…é ˆåŒ…å«è³‡æ–™æ ¼å¼éŒ¯èª¤ã€è³‡æ–™åº«é€£æ¥å¤±æ•—ã€åƒæ•¸ä¸åˆæ³•ç­‰è·¯å¾‘ã€‚
3.  **ä¿æŒæ¸¬è©¦ç¨ç«‹æ€§**: æ¯å€‹æ¸¬è©¦æ¡ˆä¾‹æ‡‰è©²ç›¸äº’ç¨ç«‹ï¼Œä¸ä¾è³´å‰ä¸€å€‹æ¸¬è©¦çš„åŸ·è¡Œç‹€æ…‹ã€‚
4.  **ä½¿ç”¨ Table-Driven Tests**: å°æ–¼å¤šåƒæ•¸ã€å¤šé æœŸçµæœçš„é‚è¼¯ï¼ˆå¦‚ Evaluatorsï¼‰ï¼Œå„ªå…ˆä½¿ç”¨ Go çš„ Table-driven æ¨¡å¼ã€‚

---

---

## 5. ç›®å‰é€²åº¦ (Current Progress)

æœ€å¾Œæ›´æ–°æ—¥æœŸï¼š2026-02-28

ç›®å‰å°ˆæ¡ˆå„ package çš„æ¸¬è©¦è¦†è“‹ç‡å¦‚ä¸‹ï¼š

| Package | Category | Coverage | Status |
| :--- | :--- | :--- | :--- |
| `internal/domain/analysis` | Domain | 100.0% | âœ… Target Met |
| `internal/domain/dataingestion` | Domain | 97.0% | âœ… Target Met |
| `internal/domain/trading` | Domain | 90.9% | âœ… Target Met |
| `internal/domain/strategy` | Domain | 81.2% | âœ… Target Met |
| `internal/domain/auth` | Domain | 80.0% | âœ… Target Met |
| `internal/application/dataingestion` | Application | 95.0% | âœ… Target Met |
| `internal/application/mvp` | Application | 90.0% | âœ… Target Met |
| `internal/application/strategy` | Application | 88.4% | âœ… Target Met |
| `internal/application/auth` | Application | 87.0% | âœ… Target Met |
| `internal/application/analysis` | Application | 82.9% | âœ… Target Met |
| `internal/application/trading` | Application | 68.3% | ğŸ“ˆ Improving |
| `internal/infrastructure/config` | Infrastructure | 60.0% | ğŸ“ˆ Improving |
| `internal/infrastructure/persistence/postgres`| Infrastructure | 56.0% | ğŸ“ˆ Improving |
| `internal/interface/http` | Interface | 51.4% | ğŸ“ˆ Improving |
| `internal/infrastructure/auth` | Infrastructure | 50.8% | ğŸ“ˆ Improving |

**å‚™è¨»**:
*   Domain å±¤å·²å…¨æ•¸é”åˆ° >80% é–€æª»ã€‚
*   Application å±¤é™¤ `trading` å¤–ä¹Ÿå·²é”æ¨™ã€‚
*   æ¥ä¸‹ä¾†é‡é»å°‡æ”¾åœ¨æå‡ `internal/interface/http` èˆ‡ `internal/infrastructure` çš„è¦†è“‹ç‡ã€‚
