<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BTC/USDT 操作台｜AI Auto Trade</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <section id="loginPage" class="auth-page">
    <div class="auth-shell">
      <div class="auth-hero">
        <div class="brand-mark">BTC</div>
        <div>
          <h1>BTC/USDT 操作台</h1>
          <p class="subtitle">登入後即可操作擷取、分析與強勢篩選。</p>
          <div class="meta-row">
            <span class="status-pill">安全連線 · HTTPS</span>
            <span class="status-pill">資料不外流</span>
          </div>
        </div>
      </div>
      <div class="auth-card">
        <div class="panel-head">
          <div>
            <h2>登入</h2>
            <p>使用預設帳號 admin / analyst / user，密碼皆為 password123。</p>
          </div>
        </div>
        <form id="loginForm" class="form">
          <div class="field-grid">
            <label>帳號 Email <input type="email" id="email" value="admin@example.com" required></label>
            <label>密碼 <input type="password" id="password" value="password123" required></label>
          </div>
          <div class="actions">
            <button type="submit" class="primary">登入</button>
            <div class="chip-row">
              <button type="button" class="chip" data-email="admin@example.com">admin@example.com</button>
              <button type="button" class="chip" data-email="analyst@example.com">analyst@example.com</button>
              <button type="button" class="chip" data-email="user@example.com">user@example.com</button>
            </div>
          </div>
        </form>
        <div id="loginMessage" class="message"></div>
      </div>
    </div>
  </section>

  <div id="appShell" class="hidden">
    <header class="topbar">
      <div class="brand">
        <div class="brand-mark">BTC</div>
        <div>
          <h1>BTC/USDT 操作台</h1>
          <p class="subtitle">AI Auto Trade MVP / 端到端流程</p>
        </div>
      </div>
      <div class="status-stack">
        <div id="status" class="status-pill">未登入</div>
        <div id="healthStatus" class="status-pill subtle">系統檢查：--</div>
      </div>
    </header>

    <div class="app-body">
      <aside class="sidebar">
        <div class="nav-head">功能導航</div>
        <nav class="nav-list">
          <button class="nav-link" data-section-target="overview">概覽</button>
          <button class="nav-link" data-section-target="analysis">分析查詢</button>
          <button class="nav-link" data-section-target="screener">強勢篩選</button>
          <button class="nav-link" data-section-target="strategy">策略</button>
          <button class="nav-link" data-section-target="trade">交易</button>
          <button class="nav-link" data-section-target="report">報告</button>
          <button class="nav-link" data-section-target="position">持倉</button>
          <button class="nav-link" data-section-target="logs">日誌</button>
          <button class="nav-link" data-section-target="activity">操作紀錄</button>
        </nav>
      </aside>

      <main class="layout content">
        <section class="panel hero span-2" data-section="overview">
      <div class="hero-copy">
        <h2>市場快照與作業狀態</h2>
        <p>集中顯示近期的擷取、分析與強勢篩選資訊，搭配走勢摘要快速判斷方向。</p>
        <div class="meta-row">
          <div id="overviewTime" class="meta-item">最後更新：--</div>
          <div id="overviewMode" class="meta-item">資料來源：--</div>
        </div>
      </div>
      <div class="kpi-grid">
        <article class="kpi" id="kpiHealth">
          <div class="kpi-title">系統狀態</div>
          <div class="kpi-value">--</div>
          <div class="kpi-note">等待健康檢查</div>
        </article>
        <article class="kpi" id="kpiIngestion">
          <div class="kpi-title">日 K 擷取</div>
          <div class="kpi-value">尚未執行</div>
          <div class="kpi-note">交易日 --</div>
        </article>
        <article class="kpi" id="kpiAnalysis">
          <div class="kpi-title">日批次分析</div>
          <div class="kpi-value">尚未執行</div>
          <div class="kpi-note">交易日 --</div>
        </article>
        <article class="kpi" id="kpiSummary">
          <div class="kpi-title">趨勢摘要</div>
          <div class="kpi-value">等待更新</div>
          <div class="kpi-note">--</div>
        </article>
        <article class="kpi" id="kpiScreener">
          <div class="kpi-title">強勢交易對</div>
          <div class="kpi-value">尚未查詢</div>
          <div class="kpi-note">--</div>
        </article>
      </div>
    </section>

    <section class="panel span-2" id="chartPanel" data-section="overview">
      <div class="panel-head">
        <div>
          <h2>BTC/USDT 走勢圖</h2>
          <p>滑鼠移動到走勢線上，可查看當日的分析摘要。</p>
        </div>
      </div>
      <form id="chartForm" class="form inline">
        <label>起始日期 <input type="date" id="chartStart" required></label>
        <label>結束日期 <input type="date" id="chartEnd" required></label>
        <button type="submit" class="primary">載入走勢</button>
        <button type="button" id="resetZoomBtn" class="ghost btn-sm hidden">重置範圍</button>
      </form>
      <div id="chartMeta" class="meta-row"></div>
      <div class="chart-wrap">
        <div id="chartCanvas" class="chart-canvas"></div>
        <div id="chartTooltip" class="chart-tooltip"></div>
      </div>
      <div class="subsection-title">Score ≥ 50 高分時間點</div>
      <div id="chartHighScores" class="highlight-grid"></div>
      <div class="subsection-title">條件回測（加權分數）</div>
      <div class="hint-box">
        <p>條件說明：</p>
        <ul>
          <li>Score 權重：分析分數的基礎權重（建議 1）。</li>
          <li>日漲跌加分：當日漲幅 ≥「漲幅門檻(%)」時加的分數（建議 5～15，填負值可扣分）。</li>
          <li>漲幅門檻(%)：日變動率門檻（建議 0.3%～0.8%，例 0.5=日漲幅 ≥0.5% 才加分）。</li>
          <li>量能加分：當日量能倍率 ≥「量能門檻」時加的分數（建議 5～15）。</li>
          <li>量能門檻(倍率)：當日量能 ÷ 近 5 日均量的倍率門檻（建議 1.2～1.5）。</li>
          <li>近 5 日報酬加分：當近 5 日報酬率 ≥「報酬門檻(%)」時加分（慣用 1% 左右）。</li>
          <li>均線乖離加分：收盤價相對 MA20 乖離率 ≥「乖離門檻(%)」時加分（例 1% 表示站上 MA20 且超過 1%）。</li>
          <li>總分門檻：加權總分需達到此值才算命中（短線積極 60、保守可設 70～75）。</li>
        </ul>
      </div>
      <form id="backtestForm" class="form inline">
        <label>起始日期 <input type="date" id="btStart" required></label>
        <label>結束日期 <input type="date" id="btEnd" required></label>
        <label>Score 權重 <input type="number" step="0.1" id="btScoreWeight" value="1"></label>
        <label>總分門檻 <input type="number" step="1" id="btTotalMin" value="60"></label>
        <label>新增條件
          <select id="btConditionSelect">
            <option value="">選擇條件…</option>
            <option value="change">日漲跌條件</option>
            <option value="volume">量能條件</option>
          </select>
        </label>
        <div id="btSelectedConditions" class="condition-list"></div>
        <div class="actions">
          <button type="button" class="ghost" id="loadPresetBtn">載入已存設定</button>
          <button type="button" class="ghost" id="savePresetBtn">儲存目前設定</button>
          <button type="submit" class="primary">執行回測</button>
        </div>
        <div class="combo-bar">
          <div class="combo-fields">
            <label>組合名稱 <input type="text" id="comboName" placeholder="例如：動能+量能加權"></label>
            <label>已儲存組合
              <select id="comboSelect">
                <option value="">選擇組合套用…</option>
              </select>
            </label>
          </div>
          <div class="combo-actions">
            <button type="button" class="ghost btn-sm" id="comboSaveBtn">儲存為新組合</button>
            <button type="button" class="ghost btn-sm" id="comboApplyBtn">套用組合</button>
            <button type="button" class="ghost btn-sm" id="comboDeleteBtn">刪除組合</button>
          </div>
        </div>
      </form>
      <div id="backtestSummary" class="result-panel"></div>
      <div id="backtestEvents" class="highlight-grid"></div>
    </section>

    <section class="panel" id="summaryPanel" data-section="overview">
      <div class="panel-head">
        <div>
          <h2>走勢摘要與建議</h2>
          <p>整理最新的趨勢判讀、量能與分數摘要。</p>
        </div>
        <button id="summaryBtn" class="ghost">取得最新建議</button>
      </div>
      <div id="summaryView" class="summary-view">
        <div class="empty-state">尚未取得摘要，點選右上按鈕即可更新。</div>
      </div>
    </section>

    <section class="panel span-2" id="analysisPanel" data-section="analysis">
      <div class="panel-head">
        <div>
          <h2>分析結果查詢</h2>
          <p>可依交易日查詢完整分析清單，並列出重點摘要。</p>
        </div>
      </div>
      <form id="queryForm" class="form inline">
        <label>交易日 <input type="date" id="queryDate" required></label>
        <label>筆數 <input type="number" id="queryLimit" value="20" min="1" max="1000"></label>
        <label>Offset <input type="number" id="queryOffset" value="0" min="0"></label>
        <button type="submit" class="primary">查詢</button>
      </form>
      <div id="queryMeta" class="meta-row"></div>
      <div id="queryHighlights" class="highlight-grid"></div>
      <div id="queryTable" class="table"></div>
    </section>

    <section class="panel span-2" id="screenerPanel" data-section="screener">
      <div class="panel-head">
        <div>
          <h2>強勢交易對篩選</h2>
          <p>以固定條件篩出強勢清單，顯示分數與量能。</p>
        </div>
      </div>
      <form id="screenerForm" class="form inline">
        <label>交易日 <input type="date" id="screenerDate" required></label>
        <label>Score ≥ <input type="number" id="scoreMin" value="70" step="0.1"></label>
        <label>量能倍率 ≥ <input type="number" id="volMin" value="1.5" step="0.1"></label>
        <label>筆數 <input type="number" id="screenerLimit" value="20" min="1" max="200"></label>
        <button type="submit" class="primary">查詢強勢交易對</button>
      </form>
      <div id="screenerMeta" class="meta-row"></div>
      <div id="screenerHighlights" class="highlight-grid"></div>
      <div id="screenerTable" class="table"></div>
    </section>

    <section class="panel span-2" id="strategyPanel" data-section="strategy">
      <div class="panel-head">
        <div>
          <h2>策略列表（測試版）</h2>
          <p>檢視後端已建立的策略，快速查看狀態與版本。</p>
        </div>
      </div>
      <form id="strategyForm" class="form inline">
        <label>狀態
          <select id="strategyStatus">
            <option value="">全部</option>
            <option value="active">active</option>
            <option value="draft">draft</option>
            <option value="archived">archived</option>
          </select>
        </label>
        <label>環境
          <select id="strategyEnv">
            <option value="">全部</option>
            <option value="test">test</option>
            <option value="prod">prod</option>
          </select>
        </label>
        <label>名稱關鍵字 <input type="text" id="strategyName" placeholder="例如 momentum"></label>
        <button type="submit" class="primary">載入策略</button>
      </form>
      <div id="strategyMeta" class="meta-row"></div>
      <div id="strategyTable" class="table"></div>

      <div class="subsection-title">建立策略（欄位）</div>
      <form id="createStrategyForm" class="form">
        <div class="field-grid">
          <label>名稱 <input type="text" id="createStrategyName" placeholder="例如：突破策略" required></label>
          <label>交易對 <input type="text" id="createStrategySymbol" value="BTCUSDT"></label>
          <label>週期 <input type="text" id="createStrategyTimeframe" value="1d"></label>
          <label>環境
            <select id="createStrategyEnv">
              <option value="test">test</option>
              <option value="prod">prod</option>
              <option value="both">both</option>
            </select>
          </label>
        </div>

        <div class="subsection-title">買入條件</div>
        <div class="inline">
          <label>邏輯
            <select id="buyLogic">
              <option value="AND">AND</option>
              <option value="OR">OR</option>
            </select>
          </label>
          <button type="button" class="ghost btn-sm" id="addBuyCondition">新增條件</button>
        </div>
        <div id="buyConditions" class="condition-list"></div>

        <div class="subsection-title">賣出條件</div>
        <div class="inline">
          <label>邏輯
            <select id="sellLogic">
              <option value="AND">AND</option>
              <option value="OR">OR</option>
            </select>
          </label>
          <button type="button" class="ghost btn-sm" id="addSellCondition">新增條件</button>
        </div>
        <div id="sellConditions" class="condition-list"></div>

        <div class="subsection-title">資金與風控</div>
        <div class="field-grid">
          <label>下單模式
            <select id="orderSizeMode">
              <option value="fixed_usdt">固定金額 (USDT)</option>
              <option value="percent_of_equity">資金比例 (0-1)</option>
            </select>
          </label>
          <label>下單金額/比例 <input type="number" id="orderSizeValue" value="1000" step="0.01"></label>
          <label>成交價模式
            <select id="priceMode">
              <option value="next_open">次日開盤</option>
              <option value="next_close">次日收盤</option>
              <option value="current_close">當日收盤</option>
            </select>
          </label>
          <label>手續費 (%) <input type="number" id="feesPct" value="0.1" step="0.01"></label>
          <label>滑價 (%) <input type="number" id="slippagePct" value="0.1" step="0.01"></label>
          <label>停損 (%) <input type="number" id="stopLossPct" value="3" step="0.1"></label>
          <label>停利 (%) <input type="number" id="takeProfitPct" value="6" step="0.1"></label>
          <label>冷卻天數 <input type="number" id="coolDownDays" value="1" min="0" step="1"></label>
          <label>最少持有天數 <input type="number" id="minHoldDays" value="1" min="0" step="1"></label>
          <label>最多同時持倉 <input type="number" id="maxPositions" value="1" min="1" step="1"></label>
        </div>

        <label>送出預覽（唯讀）
          <textarea id="createStrategyPreview" rows="6" spellcheck="false" readonly></textarea>
        </label>
        <div class="actions">
          <button type="button" class="ghost btn-sm" id="loadStrategyTemplate">載入範例</button>
          <button type="submit" class="primary">建立策略</button>
        </div>
        <div id="createStrategyMessage" class="message"></div>
      </form>
    </section>

    <section class="panel span-2" id="tradePanel" data-section="trade">
      <div class="panel-head">
        <div>
          <h2>交易紀錄</h2>
          <p>查詢指定策略的紙本/正式交易紀錄。</p>
        </div>
      </div>
      <form id="tradeForm" class="form inline">
        <label>策略 ID <input type="text" id="tradeStrategyId" placeholder="可留空查全部"></label>
        <label>環境
          <select id="tradeEnv">
            <option value="">全部</option>
            <option value="test">test</option>
            <option value="prod">prod</option>
          </select>
        </label>
        <label>開始日 <input type="date" id="tradeStart"></label>
        <label>結束日 <input type="date" id="tradeEnd"></label>
        <button type="submit" class="primary">查詢交易</button>
      </form>
      <div id="tradeMeta" class="meta-row"></div>
      <div id="tradeTable" class="table"></div>
    </section>

    <section class="panel span-2" id="reportPanel" data-section="report">
      <div class="panel-head">
        <div>
          <h2>報告列表</h2>
          <p>輸入策略 ID 取得已保存的回測/交易報告。</p>
        </div>
      </div>
      <form id="reportForm" class="form inline">
        <label>策略 ID <input type="text" id="reportStrategyId" required></label>
        <button type="submit" class="primary">查詢報告</button>
      </form>
      <div id="reportMeta" class="meta-row"></div>
      <div id="reportTable" class="table"></div>
    </section>

    <section class="panel span-2" id="positionPanel" data-section="position">
      <div class="panel-head">
        <div>
          <h2>持倉列表</h2>
          <p>查看目前未平倉部位（紙本/正式）。</p>
        </div>
      </div>
      <form id="positionForm" class="form inline">
        <label>環境
          <select id="positionEnv">
            <option value="">全部</option>
            <option value="test">test</option>
            <option value="prod">prod</option>
          </select>
        </label>
        <button type="submit" class="primary">查詢持倉</button>
      </form>
      <div id="positionMeta" class="meta-row"></div>
      <div id="positionTable" class="table"></div>
    </section>

    <section class="panel span-2" id="logPanel" data-section="logs">
      <div class="panel-head">
        <div>
          <h2>策略日誌</h2>
          <p>查看策略執行訊息，可依環境與筆數過濾。</p>
        </div>
      </div>
      <form id="logForm" class="form inline">
        <label>策略 ID <input type="text" id="logStrategyId" required></label>
        <label>環境
          <select id="logEnv">
            <option value="">全部</option>
            <option value="test">test</option>
            <option value="prod">prod</option>
          </select>
        </label>
        <label>筆數 <input type="number" id="logLimit" value="50" min="1" max="200"></label>
        <button type="submit" class="primary">查詢日誌</button>
      </form>
      <div id="logMeta" class="meta-row"></div>
      <div id="logTable" class="table"></div>
    </section>

    <section class="panel" id="activityPanel" data-section="activity">
      <div class="panel-head">
        <div>
          <h2>操作紀錄</h2>
          <p>保留最近的操作記錄，方便追蹤流程。</p>
        </div>
      </div>
      <ul id="activityList" class="activity-list"></ul>
    </section>
      </main>
    </div>

  <script src="main.js"></script>
</body>
</html>
