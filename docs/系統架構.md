# 系統架構與設計規範

本文件定義 AI Auto Trade 系統的架構設計、程式碼組織規範及開發標準。

---

## 1. 核心設計原則

### 1.1 分層架構 (Clean Architecture)
系統採用 Clean Architecture 原則，分為以下四層：
*   **Domain (領域層)**：核心業務模型與規則（如 `EvaluateScore`, `IsTriggered`），不依賴任何外部技術。
*   **Application (應用層)**：負責協調業務流程 (Use Cases)，處理 DTO 轉換與事務控制。
*   **Interface (介面層)**：處理外部進入點，如 HTTP Handlers、Router 等。
*   **Infrastructure (基礎建設層)**：實作具體技術細節，如資料庫持久化 (Postgres)、外部 API 調用 (Binance)。

### 1.2 依賴方向 (Dependency Rule)
依賴關係只能從「外層」指向「內層」。例如 Interface 層可以調用 Application 層，但 Domain 層絕不允許依賴 Infrastructure。

---

## 2. 目錄結構

```
.
├── cmd/
│   └── api/                # 系統進入點，負責 DI 與啟動 Server
├── internal/
│   ├── domain/             # 業務核心（Entity, VO, Repository Interface）
│   ├── application/        # 業務邏輯 (Use Case)
│   ├── interface/          # HTTP Handlers, Middleware, DTOs
│   ├── infrastructure/     # DB Repository, Binance Client 實作
│   └── pkg/                # 共用工具類 (Logging, Crypto, Utils)
├── web/                    # 前端靜態資源 (HTML, CSS, JS)
├── db/                     # 資料庫 Migration 腳本
└── docs/                   # 系統規格與說明文件
```

---

## 3. 重要實作規範

### 3.1 錯誤處理
*   全面使用 Golang 的 `error` 機制。
*   在 Domain 層定義常用的錯誤常數，避免基礎建設層的具體錯誤滲透到內層。

### 3.2 測試策略
*   **單元測試**：Domain 與 Application 層必須具備完整的單元測試，達成邏輯覆蓋。
*   **平行開發**：測試檔應與實作檔放在同一個 package，並以 `_test.go` 命名。

### 3.3 自動化更新紀錄
*   **Migration**：所有的資料庫變更必須透過 `db/migrations` 下的 SQL 腳本執行。
*   **API 規格**：介面變更需同步反映於 `docs/技術規格.md` 與 OpenAPI 文件。

---

## 4. 前後端溝通
*   系統採用 RESTful API 進行溝通。
*   前端 Web Console 直接讀取後端輸出的靜態檔案 (Vite/Vanilla JS)。
*   採用 JWT 進行身分驗證，登入後 Token 儲存於 `localStorage` 或 Cookie。
