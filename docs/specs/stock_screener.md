# 選股器（Stock Screener）功能規格

版本：v1.0  
狀態：草稿  
最後更新：2025-12-02

---

## 1. 功能簡介

本文件定義「選股器（Stock Screener）」之產品需求與行為規格。

選股器的目標：  
基於「分析結果」資料，讓使用者能以條件組合的方式，快速找到符合特定特徵的股票，例如：

- 近 5 日強勢且量能放大
- 接近前高且均線多頭
- 低波動整理後突破
- 特定產業中短期強勢股

本功能屬於整個系統的上層核心功能，直接面向使用者，也為後續策略、排程通知與報告輸出打下基礎。

---

## 2. 範圍與非範圍

### 2.1 功能範圍（In Scope）

- 使用「條件組合」來篩選全市場的分析結果
- 支援邏輯運算（AND / OR）
- 支援多類型條件：
  - 數值條件（大於、小於、介於）
  - 類別條件（市場、產業）
  - 標籤（tags）條件
  - 排序與分頁
- 支援「選股模板」（預設策略組合）
- 支援「使用者自訂條件」保存（内部版本）
- 與查詢介面整合（Query & Export）

### 2.2 非範圍（Out of Scope）

- 多層次布林邏輯（如 AND/OR 巢狀條件）
- 即時盤中選股（v1 僅使用分析結果，為日階層）
- 對外帳號／使用者登入系統（僅設計，不實作）

---

## 3. 前置條件與依賴

本功能需依賴：

- 日批次分析核心（Daily Batch Analysis Core）
- 分析結果查詢與輸出介面（Query & Export）

選股器本質上即是 Query & Export 的「高階使用介面」，因此所有條件均以分析結果欄位為基礎。

---

## 4. 使用情境與角色

### 4.1 使用情境

1. 使用者希望快速找到「今日強勢股」，使用預設模板。
2. 使用者希望找到「近 20 日報酬 > 10% 且均線多頭排列」的股票。
3. 使用者想搜尋「量能放大、相對產業強於大盤」的股票。
4. 研究人員想建立自訂選股條件，重複套用。
5. 後端系統依選股器條件，每日產生固定清單並匯出。

### 4.2 使用者角色

- 普通使用者（前端 UI）
- 研究人員（內部）
- 策略服務（內部）

---

## 5. 選股條件模型（Condition Model）

選股器必須能表示各種條件，需具備「統一結構、可組合」。

### 5.1 基本條件類型

選股器需至少支援以下五大類：

#### 類型 A：數值條件（Numeric Condition）

針對分析結果中的數值欄位：

- 收盤價
- 近 5 日報酬
- 近 20 日報酬
- 近 60 日報酬
- 成交量放大倍率
- 均線乖離率
- 分數（score）
- 波動度

支援運算：

- 大於（>）
- 小於（<）
- 介於（between）
- 大於等於（>=）
- 小於等於（<=）

#### 類型 B：類別條件（Category Condition）

針對具有分類意義的欄位：

- 市場別（上市／上櫃）
- 產業別
- 股票種類（一般、ETF、ETN…）

支援：

- 等於（=）
- 多選（IN）

#### 類型 C：標籤（Tags）條件

例如：

- 必須包含以下任一標籤：
  - 量能放大
  - 短期強勢
- 必須同時包含多項標籤
- 必須「不包含」某些標籤（例如排除高波動）

#### 類型 D：文字匹配（Text Condition）（可選）

- 股票名稱包含某關鍵字（例如搜尋公司名）
- 但此功能可視 v1 是否需要，初版可不強制

#### 類型 E：股票代碼列表條件（ID List Condition）

允許使用者直接輸入股票代碼列表：

- [2330, 2303, 3034]
- 支援 include / exclude


---

## 6. 邏輯運算

### 6.1 單層布林邏輯（v1）

v1 規範使用：

- AND（所有條件需同時成立）
- OR（任一條件成立）

但為避免複雜度爆炸：

- 不支援巢狀結構（no nested AND/OR）
- 支援單一層組合，例如：

