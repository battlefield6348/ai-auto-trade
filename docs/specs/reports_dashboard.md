# 報表與儀表板服務（Reports & Dashboard Service）功能規格

版本：v1.0  
狀態：草稿  
最後更新：2025-12-02

---

## 1. 功能簡介

本文件定義「報表與儀表板服務（Reports & Dashboard Service）」之產品需求與行為規格。

目的：

- 將分析結果、選股結果、策略觸發、訂閱通知等資料，以「即時摘要儀表板」與「可下載報表」的方式呈現。
- 提供高階管理者與使用者快速理解市場狀態、策略表現及系統健康情況。

此功能並非資料計算核心，而是以「查詢 + 視覺化 + 匯出」方式整合整個平台數據。

---

## 2. 範圍與非範圍

### 2.1 功能範圍（In Scope）

- 市場總覽儀表板（Market Overview Dashboard）
- 產業族群儀表板（Sector/Industry Dashboard）
- 股票個股儀表板（Stock Detail Dashboard）
- 系統狀態儀表板（System Health Dashboard）
- 策略績效儀表板（Strategy Performance Dashboard）
- 提供可下載的報表（CSV 或等價）
- 可依時間與條件產出統計摘要

### 2.2 非範圍（Out of Scope）

- 盤中分時走勢圖（v1 不做）
- 過於複雜的多維度圖表（如交互式 3D）
- 技術線圖生成（可用第三方前端工具處理）

---

## 3. 前置條件與依賴

本服務依賴：

- 分析結果查詢介面（Query & Export）
- 選股器（Screener）
- 訂閱與通知系統（Alert/Notification Engine）
- 策略引擎（Strategy Engine）
- Data Ingestion 任務與狀態紀錄

此功能本身不會生成資料，而是從上述系統讀取資料並組織呈現。

---

## 4. 儀表板定義

儀表板分為五類：

---

## 4.1 市場總覽儀表板（Market Overview Dashboard）

用途：

- 提供該交易日整體市場的一張全圖。

需顯示：

1. **市場表現摘要**
   - 台股加權指數（收盤、漲跌幅）
   - 上櫃指數（收盤、漲跌幅）
   - 市場成交量（上市、上櫃）
   - 市場漲跌家數

2. **強弱勢統計**
   - 近 5 日、20 日報酬的市場分布圖（例如：漲幅 >5%、跌幅 >5% 的家數）
   - 按分數（score）分布的直方圖

3. **熱門族群**
   - 今日表現最佳的產業（依平均漲幅）
   - 今日成交量成長最多的產業
   - 今日強勢股最多的產業

4. **高階標籤統計**
   - 今日「短期強勢」標籤股票數
   - 今日「量能放大」股票數
   - 今日「接近前高」股票數
   - 趨勢多頭的家數 vs 空頭家數

---

## 4.2 產業族群儀表板（Industry Dashboard）

可供「產業 → 個股」的 Drilldown 分析。

需顯示：

1. **產業整體表現**
   - 平均漲跌幅（近 1 日、近 5 日、近 20 日）
   - 平均分數（score）
   - 成交量變化（vs 20 日均值）

2. **族群輪動訊號**
   - 相對大盤強弱指標
   - 今日新增強勢股數量
   - 今日新增量能放大股數量

3. **產業內個股表格**
   - 股票清單（依分數排序）
   - 各股票的主要指標摘要（報酬、成交量、MA 狀態、標籤）

4. **產業比較**
   - 顯示前 5 強和後 5 弱產業的比較表

---

## 4.3 個股儀表板（Stock Detail Dashboard）

用途：深入查看某檔股票。

需顯示：

1. **基本資料**
   - 股票代碼、名稱、產業別、市場別

2. **歷史走勢摘要（使用分析結果而非分 K）**
   - 收盤價（以折線圖呈現）
   - 分數（score）走勢圖
   - 近 5 日、20 日、60 日報酬走勢
   - 均線狀態（例如均線排列組合）

3. **量能分析**
   - 成交量 vs 均量走勢
   - 成交量放大倍率走勢

4. **標籤日誌（Tag Timeline）**
   - 某日新增的標籤（如首次「接近前高」）
   - 標籤持續天數（如「短期強勢」連續 3 天）

5. **策略觸發紀錄（如果使用者有訂閱）**
   - 哪些策略曾命中該股
   - 觸發日與內容摘要

---

## 4.4 策略績效儀表板（Strategy Performance Dashboard）

用途：

- 給策略玩家／研究人員使用。

需顯示：

1. **策略清單**
   - 名稱
   - 啟用狀態
   - 過去 N 日觸發次數

2. **策略績效摘要**
   - 若策略是「選股策略」，可顯示：
     - 平均報酬（根據命中股）
     - 命中股票的未來 5 日平均走勢（v1 可選）
   - 若策略是「多股票條件」，可顯示：
     - 命中股票數量走勢圖
     - 族群集中度分析

3. **策略觸發歷史**
   - 每日觸發列表
   - 命中股票清單
   - 名目變化

---

## 4.5 系統健康儀表板（System Health Dashboard）

需顯示：

1. **資料取得狀態（Data Ingestion）**
   - 每日成功 vs 失敗股票數量
   - 來源 API 的延遲與錯誤率

2. **分析任務狀態**
   - 每日分析成功率
   - 分析耗時走勢
   - 異常股票清單（資料不足／驗證失敗）

3. **通知與策略執行狀態**
   - 每日通知數量
   - 每日策略執行耗時
   - 策略錯誤率統計

4. **資料品質檢查**
   - 異常價格（例如高低反轉）
   - 零成交日（非停牌卻為 0）
   - 成交量異常 spikes

---

## 5. 報表（Reports）

報表是「可下載」的市場分析摘要。

### 5.1 報表種類（v1）

1. **每日市場報告**  
   - 市場摘要  
   - 強勢股清單  
   - 產業排行  
   - 量能放大股  

2. **產業報告**
   - 產業整體表現  
   - 個股指標清單（完整 CSV）

3. **策略觸發報告**
   - 某策略在某一日期觸發的股票列表  
   - 條件摘要  

4. **個股報告（依使用者要求）**
   - 近期指標走勢  
   - 標籤日誌  
   - 分數變化  

### 5.2 報表格式

- CSV（必備）
- JSON（行為定義層，可選）
- PDF（v2）

---

## 6. 查詢功能需求

儀表板內所有資料須可透過程式查詢：

1. 查詢市場摘要  
2. 查詢某產業在某日的完整結果  
3. 查詢某股票在某段期間的分析結果摘要  
4. 查詢某策略在某日是否觸發  

此功能不會新增新的資料表，而是從 Query Engine + Strategy Engine 中讀取。

---

## 7. 權限需求（邏輯）

- 普通使用者：
  - 市場總覽  
  - 個股儀表板  
  - 選股結果與策略觸發摘要  

- 研究人員／內部：
  - 完整產業儀表板  
  - 系統健康儀表板  

---

## 8. 非功能性需求

### 8.1 效能

- 儀表板載入需在 300–800ms 內完成
- 報表匯出需在 1–5 秒內完成

### 8.2 穩定性

- 報表生成不可阻塞其他系統
- 若資料缺失需清楚顯示（例如「今日資料不完整」）

### 8.3 可觀測性

- 儀表板查詢需記錄：
  - 查詢類型
  - 耗時
  - 返回筆數

---

## 9. 開發與測試重點

### 9.1 開發重點

1. 整合 Query Engine 的查詢能力  
2. 定義儀表板模型（Dashboard Model）  
3. 報表生成器  
4. 報表下載 API  
5. 市場、產業、個股摘要計算邏輯  

### 9.2 測試建議

- 單元測試：
  - 市場統計計算
  - 產業排行
  - 個股摘要產生器

- 整合測試：
  - 全流程（從 Query → Summary → Dashboard）

---

## 10. 未來擴充（非 v1）

- 支援前端互動式圖表
- 支援 PDF 報告模板
- 支援多語系摘要（TW/EN）
- 支援自動寄送報表（結合通知系統）

